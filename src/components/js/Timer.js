import React, { useState, useEffect } from "react";
import { buildStyles, CircularProgressbarWithChildren } from "react-circular-progressbar";
import "react-circular-progressbar/dist/styles.css";
import "../css/Timer.css";

import { useTime } from "../../contexts/TimeContext";

const Timer = () => {
  const { elapsedTime, timeDisplay, timeObj } = useTime();
  const [dayPercent, setDayPercent] = useState();

  useEffect(() => {
    const getPercent = () => {
      let d = elapsedTime / 86400000;
      //get the percent of the day from d
      var decimal = d - Math.floor(d);

      //get the percent of the day from decimal
      var percent = decimal * 100;
      setDayPercent(percent);
    };

    return getPercent();
  }, [elapsedTime]);

  return (
    <div className="timerContainerDiv">
      <CircularProgressbarWithChildren
        value={dayPercent}
        styles={buildStyles({ textSize: "1rem", strokeLinecap: "round" })}
        strokeWidth={4}
        className="darkmode-ignore"
      >
        <div className="timerContents">
          <h1 className="days">
            {timeObj.d !== 1 ? timeObj.d + " days" : timeObj.d + " day"}
          </h1>
          <h2 className="clock">{timeDisplay}</h2>

          <h3 className="sobriety">of sobriety</h3>

          <svg
            className="
        chain"
            xmlns="http://www.w3.org/2000/svg"
            width="236"
            height="111"
            viewBox="0 0 500 500"
          >
            <path
              style={{ fill: "#44444400", stroke: "none" }}
              d="M0 0L0 500L436 500L436 0L0 0z"
            />
            <path className="chainPath"
              d="M202 171C208.763 171 215.311 170.954 222 172.081C225.198 172.62 229.605 174.363 232.715 172.887C238.749 170.022 244.156 162.087 248.87 157.421C264.941 141.51 279.292 124.361 303 121.289C339.686 116.536 370.248 155.541 361.826 190C357.069 209.464 340.528 222.472 327 236L298 265C291.72 271.28 285.614 278.328 278 283.046C262.622 292.574 242.332 294.899 226 286.445C220.094 283.388 214.772 279.624 210.015 274.961C203.686 268.757 199.047 261.291 196 253C187.586 255.499 182.931 263.118 176 268C178.339 278.221 186.599 287.566 194.174 294.46C215.943 314.271 243.722 319.865 272 312.961C292.75 307.895 308.054 290.875 322.424 276.285C348.703 249.606 381.443 226.254 387.561 187C395.604 135.397 347.787 92.1924 298 97.1705C266.43 100.327 247.045 123.955 226 145C218.268 152.732 206.65 161.029 202 171M259 261C262.548 260.294 265.164 258.819 268 256.532C271.385 253.801 277.216 249.496 278.183 245.004C278.96 241.394 275.4 237.718 273.564 234.961C267.171 225.36 258.818 216.717 249 210.559C222.129 193.703 187.251 194.215 161 212.029C151.607 218.404 143.985 227.011 136 235C133.449 237.553 128.408 241.107 128.037 245C127.585 249.75 137.097 258.392 141 260.248C145.039 262.17 148.47 257.51 151 254.999C158.751 247.305 166.21 239.29 175 232.746C204.067 211.107 247.582 227.576 259 261M125 207C123.961 212.036 122.762 217.036 121.424 222C120.825 224.225 119.65 227.303 120.643 229.57C122.125 232.955 128.383 233.625 130.467 230.678C134.238 225.345 136.138 215.397 137 209L125 207M107 231C103.589 228.392 100.996 225.063 97.9853 222.001C96.0954 220.078 93.7471 217.031 91 216.346C87.4169 215.452 82.4504 220.416 83.3457 224C84.1192 227.096 87.7287 229.603 90 231.576C96.7231 237.415 102.276 241.095 107 231M74 258C74.2644 261.032 74.5993 267.101 77.5633 268.868C79.7562 270.176 82.8558 268.408 85 267.769C89.9426 266.296 94.8317 264.268 100 264C99.8331 260.173 99.0342 256.68 98 253C89.8752 254.049 82.0059 256.348 74 258M111 259C104.404 268.363 94.789 275.471 87.1736 284C75.9471 296.573 68.3301 313.087 67.0903 330C63.2714 382.098 109.446 424.613 161 416.561C190.669 411.927 209.083 388.713 229.272 368.92C236.758 361.58 248.271 353.354 253 344C246.366 343.999 239.56 343.586 233 342.561C229.461 342.008 225.459 340.398 222 342.042C217.363 344.247 213.574 349.426 210 353C201.697 361.303 193.613 369.929 185 377.91C165.595 395.891 136.458 398.2 115 382.239C90.5288 364.037 83.6125 329.766 102.34 305C107.854 297.708 114.562 291.452 121 285C123.326 282.669 127.652 279.541 128.079 276.015C128.412 273.256 125.755 271.354 123.981 269.715C119.836 265.885 116.154 261.403 111 259z"
            />
          </svg>
        </div>
      </CircularProgressbarWithChildren>
    </div>
  );
};

export default Timer;
